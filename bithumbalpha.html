<!DOCTYPE html>
<html lang="en">
  <body>
    <input type="text" id="input_money" />
    <button onclick="button_One()">목표 금액 입력</button>
    <!-- <textarea id="tempout"></textarea> -->
    <button onclick="pharseAuto()">수동 갱신</button>
    <br />
    <input type="text" id="input_time" />
    <button onclick="button_Two()">시작 시간 입력</button>
    <a href="https://heavenly-appear.tistory.com/260" target="_sub"
      >유닉스 시간 계산기 1</a
    >
    <a
      href="http://www.hipenpal.com/tool/date-string-to-unix-time-mktime-converter-in-korean.php"
      target="_sub"
      >유닉스 시간 계산기 2</a
    >
    <br />
    <br />
    <div id="daegeum"></div>
    <br />
    <div id="gijoontime"></div>
    <br />
    <div id="alarmDiv"></div>
    <br />

    <script>
      // jQuery 고려 중..

      // global variable from here
      var objectmoney;
      var objecttime;
      // global variable ended

      /* from here JSON phasrsing*/
      fetch("https:/\/api.bithumb.com/public/ticker/ALL_KRW").then(function(
        response
      ) {
        response.text().then(function(text) {
          const json = text;
          const obj = JSON.parse(json);
          total = 0;
          timestamp = obj.data.date;
          for (var i in obj.data) {
            // console.log(i + " " + obj.data[i].acc_trade_value);
            if (obj.data[i].acc_trade_value != undefined)
              total += Number(obj.data[i].acc_trade_value);
          }
          document.getElementById("daegeum").innerHTML = "거래대금 : " + total; // HTML visualization
          document.getElementById("gijoontime").innerHTML =
            "Bithumb 서버 기준 시각 " + msToTime(parseInt(timestamp));
          if (objectmoney != undefined) {
            if (total > objectmoney) {
              console.log("if문안에 " + objectmoney);
              document.getElementById("alarmDiv").innerHTML =
                objectmoney + " 안됐어";
            } else {
              console.log("else문안에 " + objectmoney);
              document.getElementById("alarmDiv").innerHTML =
                objectmoney + " 됐어";
            }
          }
        });
      });
      /* JSON pharsing ended */

      /* 2nd */
      function pharseAuto() {
        fetch("https:/\/api.bithumb.com/public/ticker/ALL_KRW").then(function(
          response
        ) {
          response.text().then(function(text) {
            const json = text;
            const obj = JSON.parse(json);
            total = 0;
            timestamp = obj.data.date;
            for (var i in obj.data) {
              // console.log(i + " " + obj.data[i].acc_trade_value);
              if (obj.data[i].acc_trade_value != undefined)
                total += Number(obj.data[i].acc_trade_value);
            }
            document.getElementById("daegeum").innerHTML =
              "거래대금 : " + total; // HTML visualization
            document.getElementById("gijoontime").innerHTML =
              "Bithumb 서버 기준 시각 " + msToTime(parseInt(timestamp));
            if (objectmoney != undefined) {
              if (total > objectmoney) {
                console.log("if문안에 " + objectmoney);
                document.getElementById("alarmDiv").innerHTML =
                  objectmoney + " 안됐어";
              } else {
                console.log("else문안에 " + objectmoney);
                document.getElementById("alarmDiv").innerHTML =
                  objectmoney + " 됐어";
              }
            }
          });
        });
      }

      /* from here ms to Time function*/
      function msToTime(duration) {
        duration += 32400000; // for UTC + 9 hours (KST)
        var milliseconds = parseInt((duration % 1000) / 100),
          seconds = parseInt((duration / 1000) % 60),
          minutes = parseInt((duration / (1000 * 60)) % 60),
          hours = parseInt((duration / (1000 * 60 * 60)) % 24);

        hours = hours < 10 ? "0" + hours : hours;
        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        return hours + ":" + minutes + ":" + seconds + "." + milliseconds;
      }
      /* ms to Time function ended */

      /* from here button One function */
      function button_One() {
        objectmoney = document.getElementById("input_money").value;
        if (objectmoney != undefined) {
          document.getElementById("alarmDiv").innerHTML =
            objectmoney + "\\으로 이벤트 목표금액 설정 완료";
        }
        console.log(objectmoney);
      }
      /* button One function ended */

      /* from here button Two function */
      function button_Two() {
        objecttime = document.getElementById("input_time").value;
        if (objecttime != undefined) {
          document.getElementById("alarmDiv").innerHTML =
            objecttime + " UNIX시로 이벤트 시작 시간 설정 완료";
        }
        console.log(objecttime);
      }
      /* button Two function ended */

      /* from here ... */
      /* from here ... ended */

      /* from here reloading test */

      var req = new XMLHttpRequest();
      req.open("POST", "/bithumbalpha.html", true);
      req.onreadystatechange = function() {
        if (req.readyState != 4 || req.status != 200) return;
        document.getElementById("daegeum") = req.responseText;
      };
      /* reloading test ended */
    </script>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
      var auto_refresh = setInterval(function() {
        $("#daegeum")
          .load("refresh.html")
          .fadeIn("slow");
      }, 1000); // 새로고침  1000은 1초를 의미
    </script>
  </body>
</html>
<!-- wss://pubwss.bithumb.com/pub/ws -->
<!-- https://api.bithumb.com/public/ticker/ALL_KRW -->
<!-- 현재시각이 입력시간(ex: 12시) 보다 커지는 순간, n초마다의 거래대금(A)을 불러오고, 입력시간 당시의 거래대금(B)를 뺀다.
입력 거래대금(C) 보다 커지는 순간 알람 및 표시한다.
-->

<!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.0/jquery.min.js"></script>
<script type="text/javascript">
var auto_refresh = setInterval(
function ()
{
$('#load_tweets').load('refresh.html').fadeIn("slow");
}, 3000); // 새로고침  1000은 1초를 의미
</script>
<body>
<div id="load_tweets"> </div>
</body>]-->
